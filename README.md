Metrics for <STM> Labs
=============================
Данный проект является серверным приложением, который принимает и сохраняет метрики, которые ему присылают используя Rest API.

Выполнено: 
1.	Создание инфраструктуры приложения с помощью Spring Boot
2.	Создание ООП и реляционной моделей данных 
3.	Реализация маппинга ООП модели на реляционную модель. Реализация уровня доступа к данным и сервисного уровня для получения и сохранения метрик.
4.	Реализация REST API, использующего разработанные выше сервисы.
5.	Реализация junit тестов, покрывающих сервисный уровень для тестирования функционала получения, сохранения и валидации запросов.

INSTALLATION
------------

Распакуйте архив в директорию на вашем ПК. Убедитесь что после распаковки архива вы видите следующие файлы и каталоги.

      metrics/           Корневой узел проекта
      README.md		     Краткое описание проекта
     

QUICK START
-----------
Перед запуском приложения убедитесь что на вашем компьютере установлен Maven.
Подробнее об установке Maven ...

Для успешного запуска приложение необходимо наличие установленного сервера PostgreSQl 9.3 и выше
	host = localhost
	port = 5432
	user = root
	userPass = root
	
Так же необходимо наличие созданной базы данных с именем METRICS_DB:	
	owner:root 
	pass:root
Если вы хотите создать базу данных со своим именем или использовать другой сервер то,
адрес сервера, имя базы данных и данные пользователя можно поменять в файле application.properties расположенном по следущему пути:
		/metrics/src/main/resources/application.properties)
		
Порядок запуска приложения:

	1.Запустите среду разработки IntelliJ IDEA.
	2.Перейдите во вкладку File -> Open -> укажите путь к каталогу "metrics/"
	3.Откроется проект.
	4.Дождитесь загрузки необходимых для работы приложения библиотек.
	  Загрузка осуществляется автоматически благодаря Maven 
	5.В дереве проекта перейдите по следующему пути
		metrics/src/main/resources/db/ и найдите файл initDB.sql
		Выделите данный файл и запустите файл на исполнение путем нажатия на сочетание Ctrl+Shift+F10 или ПКМ->Run
		
		При успешном выполнении скрипта, в базе данных METRIC_DB в схеме public должны появиться следующие таблцицы:
			- attributes
			- cpu_metrics
			- hdd_metrics
			- memory-metrics
			- ssd_metrics
			- task_metrics

	6.Запустите проект Shift+F10
	
	NOTE: для успешного запуска проекта необходимо чтобы порт :8080 был не занят сторонним приложением.
	Для просмотра используемых портов на ОС Windows выполните в командной строке команду  netstat -ano 

TESTING
-----------
	Для тестирования функционала приложения разработаны Unit-тесты на получение
		POST запросов с набором метрик для их сохранения в базу данных
		GET запросов с выборками метрик,
	
Автоматизированное тестирование:
	
	1. Тестирование POST запроса с набором метрик
	В дереве проекта перейдите по следующему пути
		metrics/src/test/java/api/v1/metrics/postTest/
		Откройте файл MetricsPostTest.java запустите на исполнение путем нажатия на сочетание Ctrl+Shift+F10 или ПКМ->Run

		При успешном выполнении теста в шапке командной строки IntelliJ IDEA появится надпись "1 test passed" и в базу данных будет добавлено по 1 новой записи для каждой метрики.
		Повторите данную процедуру 3 раза для добавления 3х записей по каждой метрике для дальнейшего тестирования GET запросов.
		
	2. Тестирование GET запросов	
	В дереве проекта перейдите по следующему пути
		metrics/src/test/java/api/v1/metrics/getTest/
		Откройте файл MetricsGetTest.java запустите на исполнение путем нажатия на сочетание Ctrl+Shift+F10 или ПКМ->Run

		При успешном выполнении теста в шапке командной строки IntelliJ IDEA появится надпись "All 22 test passed".
		
		Данные тесты покрывают выполнение следующих требований:
		
		1. Получение GET запроса http://localhost:8080/api/v1/metrics/get/{name}/{count}
			
				name - тип метрики (cpu, hdd, sdd, memory, taskCount);
				count - число получаемых записей.
				
			Возвращает указанное число записей указанного типа метрик. 
			
		2. Получение GET запроса http://localhost:8080/api/v1/metrics/get/{name}		
		
				name - тип метрики (cpu, hdd, sdd, memory, taskCount)
				Возвращает  последние 3 записи соответсвующего типа.
				
		3. Получение GET запроса http://localhost:8080/api/v1/metrics/get/all/{count}			
				
				count - число получаемых записей.
				Возвращает указанное число записей всех тиипов метрик. 
				
			Возвращает указанное число записей указанного типа метрик. 
			
		4. Получение GET запроса http://localhost:8080/api/v1/metrics/get/all		
		
				Возвращает  последние 3 записи всех типов метрик.
				
		5.	Получение ошибки 400 Bad_Request в случаях если:		
				имя метрики не указано;
				указанной метрики не существует.
				
Ручное тестирование:

	Тестирование GET запросов

	!Внимание все данные запрашиваемые в браузере возвращаются в формате Json.
	
	Откройте Ваш веб-браузер.
	
		1. Введите ссылку http://localhost:8080/api/v1/metrics/get/cpu/2 нажмите Enter
			Ожидаемый результат: в браузере будут отображены 2 самые "свежие" метрики cpu
			
		2. Введите ссылку http://localhost:8080/api/v1/metrics/get/hdd/2 нажмите Enter
			Ожидаемый результат: в браузере будут отображены 2 самые "свежие" метрики hdd
			
		3. Введите ссылку http://localhost:8080/api/v1/metrics/get/ssd/2 нажмите Enter
			Ожидаемый результат: в браузере будут отображены 2 самые "свежие" метрики ssd
			
		4. Введите ссылку http://localhost:8080/api/v1/metrics/get/memory/2 нажмите Enter
			Ожидаемый результат: в браузере будут отображены 2 самые "свежие" метрики memory
			
		5. Введите ссылку http://localhost:8080/api/v1/metrics/get/taskCount/2 нажмите Enter
			Ожидаемый результат: в браузере будут отображены 2 самые "свежие" метрики taskCount		

		6. Введите ссылку http://localhost:8080/api/v1/metrics/get/cpu/all нажмите Enter
			Ожидаемый результат: в браузере будут отображены все метрики cpu
			
		7. Введите ссылку http://localhost:8080/api/v1/metrics/get/hdd/all нажмите Enter
			Ожидаемый результат: в браузере будут отображены все метрики hdd
			
		8. Введите ссылку http://localhost:8080/api/v1/metrics/get/ssd/all нажмите Enter
			Ожидаемый результат: в браузере будут отображены всеметрики ssd
			
		9. Введите ссылку http://localhost:8080/api/v1/metrics/get/memory/all нажмите Enter
			Ожидаемый результат: в браузере будут отображены все метрики memory
			
		10. Введите ссылку http://localhost:8080/api/v1/metrics/get/taskCount/all нажмите Enter
			Ожидаемый результат: в браузере будут отображены все метрики taskCount
			
		11. Введите ссылку http://localhost:8080/api/v1/metrics/get/cpu нажмите Enter
			Ожидаемый результат: в браузере будут отображены 3 самые "свежие" метрики cpu
			
		12. Введите ссылку http://localhost:8080/api/v1/metrics/get/hdd нажмите Enter
			Ожидаемый результат: в браузере будут отображены 3 самые "свежие" метрики hdd
			
		13. Введите ссылку http://localhost:8080/api/v1/metrics/get/ssd нажмите Enter
			Ожидаемый результат: в браузере будут отображены 3 самые "свежие" метрики ssd
			
		14. Введите ссылку http://localhost:8080/api/v1/metrics/get/memory нажмите Enter
			Ожидаемый результат: в браузере будут отображены 3 самые "свежие" метрики memory
			
		15. Введите ссылку http://localhost:8080/api/v1/metrics/get/taskCount нажмите Enter
			Ожидаемый результат: в браузере будут отображены 3 самые "свежие" метрики taskCount
		
		16. Введите ссылку http://localhost:8080/api/v1/metrics/get/all нажмите Enter
			Ожидаемый результат: в браузере будут отображены 3 самые "свежие" по каждому типу
			
		17. Введите ссылку http://localhost:8080/api/v1/metrics/get/all/2 нажмите Enter
			Ожидаемый результат: в браузере будут отображены 2 самые "свежие" по каждому типу
			
		18. Введите ссылку http://localhost:8080/api/v1/metrics/get/all/all нажмите Enter
			Ожидаемый результат: в браузере будут отображены 2 самые "свежие" по каждому типу
			
		19. Введите ссылку http://localhost:8080/api/v1/metrics/get нажмите Enter
			Ожидаемый результат: Ошибка 400 bad_request
			
		20. Введите ссылку http://localhost:8080/api/v1/metrics/get/ нажмите Enter
			Ожидаемый результат: Ошибка 400 bad_request
			
		21. Введите ссылку http://localhost:8080/api/v1/metrics/get/foo нажмите Enter
			Ожидаемый результат: Ошибка 400 bad_request
			
		22. Введите ссылку http://localhost:8080/api/v1/metrics/get/foo/ нажмите Enter
			Ожидаемый результат: Ошибка 400 bad_request
			
	Тестирование POST запроса
	
		!Внимание для отправки POST запроса необходим браузер Google Chrome или же утилита postman
		
		Тест для браузера:
		
		1. Откройте Google Chrome.
		2. Нажмите клавишу F12. Откроется панель разработчика
		3. Перейдите на вкладку Console в шапке панели разработчика
		4. Скопируйте данный код:
			
			fetch('http://localhost:8080/api/v1/metrics/post/',
			{method: "POST", headers: {'Content-Type': 'application/json'},
			body:  JSON.stringify([
			{
			"name":"cpu",
			"value":44,
			"timestamp":"2018-09-21T14:32:33.354+0000",
			"requestTimeStamp":"2018-09-21T14:32:33.354+0000",
			"param":"AMD A8 4500M APU with Radeon™ HD Graphics TEST"
			},
			{
			"name":"hdd",
			"value":74,
			"status":"UP",
			"timestamp":"2018-09-21T14:32:32.354+0000",
			"requestTimeStamp":"2018-09-21T14:32:32.354+0000",
			"param":"TOSHIBA MQ 01ABF050"
			},
			{
			"name":"ssd",
			"value":68,"status":"UP",
			"timestamp":"2018-09-21T14:32:31.354+0000",
			"requestTimeStamp":"2018-09-21T14:32:31.354+0000",
			"param":"KINGSTON MLG1267"
			},
			{
			"name":"memory",
			"value":55.8,
			"status":"UP",
			"timestamp":"2018-09-21T14:32:31.354+0000",
			"requestTimeStamp":"2018-09-21T14:32:31.354+0000",
			"param":"Slot1: SO-DIMM DDR3L 1600 MHz 4GiB"
			},
			{
			"name":"taskCount",
			"value":13,
			"status":"UP",
			"timestamp":"2018-09-21T14:32:31.354+0000",
			"requestTimeStamp":"2018-09-21T14:32:31.354+0000"
			}
			])}).then(console.log)	

		5. Вставте скопированный код в консоль разработчика
		6. Нажмите Enter
		
		Ожидаемый результат:		
		После отправки запроса от сервера в консоль придет следующий ответ
		
			Promise {<pending>}
			Response {type: "basic", url: "http://localhost:8080/api/v1/metrics/post/", redirected: false, status: 201, ok: true, …}
			
		Такой ответ означает что запрос выполнен успешно и в базы данных добавлено по 1ой новой записи для каждого типа метрик.	
				
WHAT'S NEXT
-----------
Откройте Ваш веб-браузер.

	Вы можете просмотреть список всех метрик в базе данных по ссылке: http://localhost:8080/

 


